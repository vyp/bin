#!/run/current-system/sw/bin/guile \
-e main -s
!#

(use-modules (personal scripting))
(use-modules (site pipe))

(define (xcolor-name xresource)
  (substring xresource
             (+ 1 (string-index xresource #\.))
             (string-index xresource #\:)))

(define (xcolor-value xresource)
  (->> (substring xresource (+ 1 (string-index xresource #\:)))
       (string-trim-both)))

(define (xcolors)
  (let ((xcolors '()))
    (->> (string-split (system-output "xrdb -query")
                       (lambda (c) (char=? c #\newline)))
         (filter (lambda (xresource) (string-prefix? "polybar." xresource)))
         (map (lambda (xresource)
                (set! xcolors (acons (xcolor-name xresource)
                                     (xcolor-value xresource)
                                     xcolors))
                xresource)))
    xcolors))

(define (status tag)
  (car tag))

(define (name tag)
  (cdr tag))

(define (focus? tag)
  (equal? "#" (status tag)))

(define (focused-tag? tags)
  (not (->> (filter focus? tags)
            (null?))))

(define (tag-string tag)
  (let ((padding " "))
    padding
  ))

(define (tags)
  (->> (string-split (system-output "herbstclient tag_status") char-whitespace?)
       (filter (lambda (s) (not (string-null? s))))
       (map (lambda (ws) (acons (string-ref ws 1) (string-ref ws 0) '())))))

(define (main args)
  (display (xcolors)))
