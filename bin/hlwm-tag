#!/run/current-system/sw/bin/guile \
-e main -s
!#

(use-modules (srfi srfi-1)
             (hlwm)
             (pipe))

(define (tag-next type tags)
  (find (lambda (tag) (equal? (hlwm-tag-status tag) type))
        tags))

(define (tag-action action tag)
  (if (equal? action "both")
      (begin (tag-action "move" tag)
             (tag-action "use" tag))
      (system* "herbstclient"
               (string-append action "_index")
               (-> (hlwm-tag-name->index tag)
                   (number->string)))))

(define (main args)
  (let* ((action (cadr args))
         (type (string->symbol (caddr args)))
         (tags (hlwm-tags))
         (curpos (list-index hlwm-curtag? tags))
         (prev (list-head tags curpos))
         (next (list-tail tags (+ 1 curpos))))
    (tag-action
     action
     (tag-next type
               (map (lambda (tag)
                      (if (equal? (hlwm-tag-status tag) 'urgent)
                          (string-append ":" (hlwm-tag-name tag)) tag))
                    (append next prev))))))
